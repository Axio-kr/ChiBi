<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live2D 모델</title>
    <!-- PIXI.js 라이브러리 포함 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.0.0/pixi.min.js"></script>
    <!-- Live2D 라이브러리 포함 -->
    <script src="https://your-cdn-link-to-live2d-library.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        #canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <script>
        const cubism4Model = "https://Axio-kr.github.io/ChiBi/CHIBI/CHIBI.model3.json"; // 업로드된 모델 경로
        const live2d = PIXI.live2d; 

        (async function main() {
            const app = new PIXI.Application({
                view: document.getElementById("canvas"),
                autoStart: true,
                resizeTo: window,
            });

            const backgroundImage = "https://Axio-kr.github.io/ChiBi/img/2024.03.14-020336488.png"; // 업로드된 이미지 경로

            const backgroundTexture = await PIXI.Texture.fromURL(backgroundImage);
            const backgroundSprite = new PIXI.Sprite(backgroundTexture);

            backgroundSprite.width = app.screen.width;
            backgroundSprite.height = app.screen.height;

            app.stage.addChild(backgroundSprite);

            window.addEventListener('resize', () => {
                backgroundSprite.width = app.screen.width;
                backgroundSprite.height = app.screen.height;
            });

            const models = await Promise.all([
                live2d.Live2DModel.from(cubism4Model)
            ]);

            models.forEach((model) => {
                app.stage.addChild(model);
                const initialScale = 0.5; 
                model.scale.set(initialScale);

                model.updateTransform();

                model.x = (innerWidth / 2) - (model.width / 2);
                model.y = (innerHeight / 2) - (model.height / 2);

                window.wallpaperPropertyListener = {
                    applyUserProperties: function(properties) {
                        if (properties.scale) {
                            const scaleValue = 0.7 * properties.scale.value / 100;
                            model.scale.set(scaleValue);
                            model.updateTransform();
                            model.x = (innerWidth / 2) - (model.width / 2);
                            model.y = (innerHeight / 2) - (model.height / 2);
                        }
                        if (properties.posx) {
                            model.x = (properties.posx.value * innerWidth / 100) - (model.width / 2);
                        }
                        if (properties.posy) {
                            model.y = (properties.posy.value * innerHeight / 100) - (model.height / 2);
                        }
                    }
                };

                model.on("hit", (hitAreas) => {
                    if (hitAreas.includes("Body")) {
                        model.motion("TapBody"); 
                    }
                    if (hitAreas.includes("Face")) {
                        model.motion("TapFace"); 
                    }
                });
            });
        })();
    </script>
</body>
</html>
